<!DOCTYPE html>
<html>
  <head>
    <title>介绍一个本地DynamoDB图形界面应用: dynamodb-admin</title>
    




  





  



<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/css/layouts/main.css"/>
<link rel="stylesheet" href="/css/style.css"/>
<link rel="stylesheet" href="/css/navigators/navbar.css"/>


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />


<link rel="icon" type="image/png" href="/images/site/favicon_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_2.png" />


<link rel="stylesheet" href="/css/style.css"/>

    
<meta name="description" content="介绍一个本地DynamoDB图形界面应用: dynamodb-admin" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/css/layouts/single.css"/>
<link rel="stylesheet" href="/css/navigators/sidebar.css">


    
    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-123-45', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    





  



  





  





  



<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="/">
      <img src="/images/site/main-logo_hu864bbe108f1be1ae04b57f7f2fd9d631_5637_42x0_resize_box_2.png">Shubo Zhang</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse lang-selector" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      
      </ul>
    </div>
  </div>
  
  <img src="/images/site/main-logo_hu864bbe108f1be1ae04b57f7f2fd9d631_5637_42x0_resize_box_2.png" class="d-none" id="main-logo">
  <img src="/images/site/inverted-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_2.png" class="d-none" id="inverted-logo">
</nav>



      
      
  <section class="sidebar-section" id="sidebar-section">
    <div class="sidebar-holder">
      <div class="sidebar" id="sidebar">
        <input type="text" value="" placeholder="Search" data-search="" id="search-box" />
        <div class="sidebar-tree">
          <ul class="tree" id="tree">
            <li id="list-heading"><a href="/posts" data-filter="all">Posts</a></li>
            <div class="subtree">
                
  
  
  
  
    
    
  
  
    
    <li>
      <i class="fas fa-minus-circle"></i><a class="active" href="/posts/aws/">AWS</a>
      
      <ul class="active">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/aws/dynamodb-acid/">dynamodb-acid</a></li>
  

  
  
  
  
    
    
  
  
    
    <li><a class="active" href="/posts/aws/dynamodb-admin/">dynamodb-admin</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/aws/3-ways-to-log-s3/">S3-log</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/db/">DB</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/db/mysql-count/">How to Use MySQL count</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/micronaut/">micronaut</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/micronaut/mn-graalvm/">mn-graalvm</a></li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/software-design-and-engineering/">Software Design and Engineering</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/software-design-and-engineering/clean-code/">Clean Code</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/software-design-and-engineering/clean-code/meaningful-names/">Meaningful Names</a></li>
  


      </ul>
    </li>
  


      </ul>
    </li>
  

  
  
  
  
  
    
    <li>
      <i class="fas fa-plus-circle"></i><a class="" href="/posts/tools/">Tools</a>
      
      <ul class="">
        
  
  
  
  
  
    
    <li><a class="" href="/posts/tools/mac-itsycal/">mac-itsycal</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/tools/mac-stats/">mac-stats</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/tools/mac-world-time/">mac-world-time</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/tools/owasp-cn-01/">owasp-1-sql-injection</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/tools/owasp-cn-02/">owasp-2-broken-authentication</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/tools/owasp-cn-03/">owasp-3-sensitive-data-exposure</a></li>
  

  
  
  
  
  
    
    <li><a class="" href="/posts/tools/pg12/">Postgres 12 &#43; pgadmin in Docker</a></li>
  


      </ul>
    </li>
  


            </div>
          </ul>
        </div>
      </div>
    </div>
  </section>


      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(https://shubozhang.github.io/images/default-hero.jpg);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/site/shubo_zhang.jpg'/>
          <h5 class="author-name">Shubo Zhang</h5>
          <p>March 16, 2021</p>
        </div>

        <div class="title">
          <h1>介绍一个本地DynamoDB图形界面应用: dynamodb-admin</h1>
        </div>

        <div class="post-content" id="post-content">
          <p>DynamoDB一直被人诟病没有好的query tool，查询数据很麻烦，到现在也没有。在就是本地开发不是很友好，AWS提供了Dynamodb Local，但是aws cli query数据
还是很麻烦。今天推荐一个给DynamoDB Local做的Graphical User Interface (GUI)&mdash;dynamodb-admin，可以像在AWS console一样，让本地数据可视化和操作化。</p>
<h3 id="快速设置">快速设置</h3>
<ol>
<li>
<p>通过npm安装dynamodb-admin</p>
<pre><code class="language-node" data-lang="node">npm install -g dynamodb-admin
</code></pre></li>
<li>
<p>运行docker： local dynamodb</p>
<p><code>docker-compose.yml</code> file</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile">version: <span style="color:#e6db74">&#39;3.8&#39;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>services:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  dynamodb-local:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    command: <span style="color:#e6db74">&#34;-jar DynamoDBLocal.jar -sharedDb -optimizeDbBeforeStartup -dbPath ./data&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    image: <span style="color:#e6db74">&#34;amazon/dynamodb-local:latest&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    container_name: dynamodb-local<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    ports:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - <span style="color:#e6db74">&#34;8000:8000&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    volumes:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - <span style="color:#e6db74">&#34;./docker/dynamodb:/home/dynamodblocal/data&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    working_dir: /home/dynamodblocal<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Run <code>docker-compose.yml</code> file</p>
<pre><code>docker-compose up -d
</code></pre></li>
<li>
<p>启动dynamodb-admin</p>
<ul>
<li>MacOS：
<pre><code>dynamodb-admin
    
// 或者定义region和credentials
AWS_REGION=eu-west-1 AWS_ACCESS_KEY_ID=local AWS_SECRET_ACCESS_KEY=local dynamodb-admin
</code></pre></li>
<li>Windows:
<pre><code>export DYNAMO_ENDPOINT=http://localhost:8000
dynamodb-admin
</code></pre></li>
</ul>
</li>
<li>
<p>完成</p>
<ul>
<li>DynamoDB 运行在 <code>http://localhost:8000</code></li>
<li>图形界面运行在 <code>http://localhost:8001</code></li>
</ul>
</li>
</ol>
<h3 id="ui测试">UI测试</h3>
<p>我通过aws cli command新建了两个table， 来看看UI。</p>
<ol>
<li>
<p>首页比较简洁，显示两个表。</p>
<p><img src="/images/posts/aws/dynamodb-admin/tables.png" alt="Alt text"></p>
</li>
<li>
<p>选择Music table，显示items。可以GET，SCAN，QUERY数据。</p>
<p><img src="/images/posts/aws/dynamodb-admin/items.png" alt="Alt text"></p>
</li>
<li>
<p>从UI QUERY GSI</p>
<p><img src="/images/posts/aws/dynamodb-admin/search.png" alt="Alt text"></p>
</li>
<li>
<p>Meta 可以显示schema和表的一些统计</p>
<p><img src="/images/posts/aws/dynamodb-admin/schema.png" alt="Alt text"></p>
</li>
<li>
<p>可以通过UI建表</p>
<p><img src="/images/posts/aws/dynamodb-admin/create-table.png" alt="Alt text"></p>
</li>
</ol>
<p>支持本地CRUD测试应该足够用了。</p>
<h3 id="crud测试">CRUD测试</h3>
<p>建立一个简单的Micronaut webapp来测试CRUD DynamoDB table。</p>
<p>源码：https://github.com/shubozhang/micronaut-with-java/blob/main/mn-dynamodb/</p>
<ol>
<li>
<p>通过AWS CLI创建一个Music Table，Table包括一个本地索引和全局索引</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws dynamodb create-table --cli-input-json file://music_table.json --endpoint-url http://localhost:8000
</code></pre></div><p><code>music_table.json</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;AttributeDefinitions&#34;</span>: [
    { <span style="color:#f92672">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;Artist&#34;</span>, <span style="color:#f92672">&#34;AttributeType&#34;</span>: <span style="color:#e6db74">&#34;S&#34;</span>},
    { <span style="color:#f92672">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;SongTitle&#34;</span>, <span style="color:#f92672">&#34;AttributeType&#34;</span>: <span style="color:#e6db74">&#34;S&#34;</span>},
    { <span style="color:#f92672">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;AlbumTitle&#34;</span>, <span style="color:#f92672">&#34;AttributeType&#34;</span>: <span style="color:#e6db74">&#34;S&#34;</span>},
    { <span style="color:#f92672">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;Upc&#34;</span>, <span style="color:#f92672">&#34;AttributeType&#34;</span>: <span style="color:#e6db74">&#34;S&#34;</span>}
  ],
  <span style="color:#f92672">&#34;TableName&#34;</span>: <span style="color:#e6db74">&#34;Music&#34;</span>,
  <span style="color:#f92672">&#34;KeySchema&#34;</span>: [
    {
      <span style="color:#f92672">&#34;KeyType&#34;</span>: <span style="color:#e6db74">&#34;HASH&#34;</span>,
      <span style="color:#f92672">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;Artist&#34;</span>
    },
    {
      <span style="color:#f92672">&#34;KeyType&#34;</span>: <span style="color:#e6db74">&#34;RANGE&#34;</span>,
      <span style="color:#f92672">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;SongTitle&#34;</span>
    }
  ],
  <span style="color:#f92672">&#34;LocalSecondaryIndexes&#34;</span>: [
    {
      <span style="color:#f92672">&#34;IndexName&#34;</span>: <span style="color:#e6db74">&#34;lsi_album&#34;</span>,
      <span style="color:#f92672">&#34;KeySchema&#34;</span>: [
        { <span style="color:#f92672">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;Artist&#34;</span>, <span style="color:#f92672">&#34;KeyType&#34;</span>: <span style="color:#e6db74">&#34;HASH&#34;</span>},
        { <span style="color:#f92672">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;AlbumTitle&#34;</span>, <span style="color:#f92672">&#34;KeyType&#34;</span>: <span style="color:#e6db74">&#34;RANGE&#34;</span>}
      ],
      <span style="color:#f92672">&#34;Projection&#34;</span>: {
        <span style="color:#f92672">&#34;ProjectionType&#34;</span>: <span style="color:#e6db74">&#34;ALL&#34;</span>
      }
    }
  ],
  <span style="color:#f92672">&#34;ProvisionedThroughput&#34;</span>: {
    <span style="color:#f92672">&#34;ReadCapacityUnits&#34;</span>: <span style="color:#ae81ff">3</span>,
    <span style="color:#f92672">&#34;WriteCapacityUnits&#34;</span>: <span style="color:#ae81ff">3</span>
  },
  <span style="color:#f92672">&#34;GlobalSecondaryIndexes&#34;</span>: [
    {
      <span style="color:#f92672">&#34;IndexName&#34;</span>: <span style="color:#e6db74">&#34;gsi_upc&#34;</span>,
      <span style="color:#f92672">&#34;KeySchema&#34;</span>: [
        { <span style="color:#f92672">&#34;AttributeName&#34;</span>: <span style="color:#e6db74">&#34;Upc&#34;</span>, <span style="color:#f92672">&#34;KeyType&#34;</span>: <span style="color:#e6db74">&#34;HASH&#34;</span>}
      ],
      <span style="color:#f92672">&#34;Projection&#34;</span>: {
        <span style="color:#f92672">&#34;ProjectionType&#34;</span>: <span style="color:#e6db74">&#34;ALL&#34;</span>
      },
      <span style="color:#f92672">&#34;ProvisionedThroughput&#34;</span>: {
        <span style="color:#f92672">&#34;ReadCapacityUnits&#34;</span>: <span style="color:#ae81ff">3</span>,
        <span style="color:#f92672">&#34;WriteCapacityUnits&#34;</span>: <span style="color:#ae81ff">3</span>
      }
    }
  ]
}
</code></pre></div></li>
<li>
<p>Create a model for Music Table</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@DynamoDBTable</span><span style="color:#f92672">(</span>tableName<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Music&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@ToString</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Music</span> <span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> String artist<span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> String songTitle<span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> String albumTitle<span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> Integer year<span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> String upc<span style="color:#f92672">;</span>
   
    <span style="color:#a6e22e">@DynamoDBHashKey</span><span style="color:#f92672">(</span>attributeName<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Artist&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getArtist</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> artist<span style="color:#f92672">;}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setArtist</span><span style="color:#f92672">(</span>String artist<span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">artist</span> <span style="color:#f92672">=</span> artist<span style="color:#f92672">;}</span>
   
    <span style="color:#a6e22e">@DynamoDBRangeKey</span><span style="color:#f92672">(</span>attributeName<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SongTitle&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getSongTitle</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> songTitle<span style="color:#f92672">;}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setSongTitle</span><span style="color:#f92672">(</span>String songTitle<span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">songTitle</span> <span style="color:#f92672">=</span> songTitle<span style="color:#f92672">;}</span>
   
    <span style="color:#a6e22e">@DynamoDBIndexRangeKey</span><span style="color:#f92672">(</span>attributeName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AlbumTitle&#34;</span><span style="color:#f92672">,</span> localSecondaryIndexName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;lsi_album&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getAlbumTitle</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> albumTitle<span style="color:#f92672">;}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setAlbumTitle</span><span style="color:#f92672">(</span>String albumTitle<span style="color:#f92672">)</span> <span style="color:#f92672">{</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">albumTitle</span> <span style="color:#f92672">=</span> albumTitle<span style="color:#f92672">;}</span>
   
    <span style="color:#a6e22e">@DynamoDBAttribute</span><span style="color:#f92672">(</span>attributeName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Year&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> Integer <span style="color:#a6e22e">getYear</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> year<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setYear</span><span style="color:#f92672">(</span>Integer year<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">year</span> <span style="color:#f92672">=</span> year<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
   
    <span style="color:#a6e22e">@DynamoDBIndexHashKey</span><span style="color:#f92672">(</span>attributeName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Upc&#34;</span><span style="color:#f92672">,</span> globalSecondaryIndexName<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gsi_upc&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getUpc</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> upc<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setUpc</span><span style="color:#f92672">(</span>String upc<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">upc</span> <span style="color:#f92672">=</span> upc<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li><code>PartitionKey</code>是由<code>HashKey Artist</code>和<code>RangeKey SongTitle</code>组成。</li>
<li>建立<code>LSI IndexRangeKey AlbumTitle</code>。它将和<code>HashKey Artist</code>一起用。</li>
<li>建立<code>GSI IndexHashKey Upc</code>。它可以单独引用。</li>
</ul>
</li>
<li>
<p>建立一个DBMapper class。设置client， mapper，和index</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DBMapper</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String TABLE_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Music&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String LSI_ALBUM_INDEX_NAME <span style="color:#f92672">=</span>  <span style="color:#e6db74">&#34;lsi_album&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String GSI_UPC_INDEX_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gsi_upc&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> AmazonDynamoDB client<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> DynamoDBMapper mapper<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Index lsi_album<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Index gsi_upc<span style="color:#f92672">;</span>
   
    <span style="color:#66d9ef">static</span> <span style="color:#f92672">{</span>
        AWSCredentialsProvider creds <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> AWSCredentialsProvider<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> AWSCredentials <span style="color:#a6e22e">getCredentials</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> BasicAWSCredentials<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;local&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;local&#34;</span><span style="color:#f92672">);</span> <span style="color:#f92672">}</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">refresh</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#f92672">}</span>
        <span style="color:#f92672">};</span>
        client <span style="color:#f92672">=</span> AmazonDynamoDBClientBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">standard</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">withCredentials</span><span style="color:#f92672">(</span>creds<span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">withEndpointConfiguration</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> AwsClientBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">EndpointConfiguration</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;http://localhost:8000&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;us-east-1&#34;</span><span style="color:#f92672">))</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
        mapper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DynamoDBMapper<span style="color:#f92672">(</span>client<span style="color:#f92672">);</span>
        DynamoDB dynamoDb <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DynamoDB<span style="color:#f92672">(</span>client<span style="color:#f92672">);</span>
        Table table <span style="color:#f92672">=</span> dynamoDb<span style="color:#f92672">.</span><span style="color:#a6e22e">getTable</span><span style="color:#f92672">(</span>TABLE_NAME<span style="color:#f92672">);</span>
        lsi_album <span style="color:#f92672">=</span> table<span style="color:#f92672">.</span><span style="color:#a6e22e">getIndex</span><span style="color:#f92672">(</span>LSI_ALBUM_INDEX_NAME<span style="color:#f92672">);</span>
        gsi_upc <span style="color:#f92672">=</span> table<span style="color:#f92672">.</span><span style="color:#a6e22e">getIndex</span><span style="color:#f92672">(</span>GSI_UPC_INDEX_NAME<span style="color:#f92672">);</span>
   
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> DynamoDBMapper <span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(){</span> <span style="color:#66d9ef">return</span> mapper<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Index <span style="color:#a6e22e">getLSIAlbumTitle</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> lsi_album<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Index <span style="color:#a6e22e">getGSIUpc</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> gsi_upc<span style="color:#f92672">;</span> <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>Create a MusicDao for CRUD</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Singleton</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MusicDao</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> DynamoDBMapper mapper <span style="color:#f92672">=</span> DBMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Index lsiAlbum <span style="color:#f92672">=</span> DBMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">getLSIAlbumTitle</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Index gsiAlbum <span style="color:#f92672">=</span> DBMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">getGSIUpc</span><span style="color:#f92672">();</span>
   
    <span style="color:#66d9ef">public</span> Music <span style="color:#a6e22e">getItem</span><span style="color:#f92672">(</span>Music music<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> <span style="color:#66d9ef">return</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">load</span><span style="color:#f92672">(</span>music<span style="color:#f92672">);</span> <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">saveItem</span><span style="color:#f92672">(</span>Music music<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">save</span><span style="color:#f92672">(</span>music<span style="color:#f92672">);</span> <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">deleteItem</span><span style="color:#f92672">(</span>Music music<span style="color:#f92672">)</span> <span style="color:#f92672">{</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">delete</span><span style="color:#f92672">(</span>music<span style="color:#f92672">);</span> <span style="color:#f92672">}</span>
   
    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>Music<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">queryItemByLSI</span><span style="color:#f92672">(</span>Music music<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> JsonProcessingException <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>Music<span style="color:#f92672">&gt;</span> musicList <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
        QuerySpec spec <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> QuerySpec<span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">withKeyConditionExpression</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Artist = :v_artist and AlbumTitle = :v_title&#34;</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">withValueMap</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ValueMap<span style="color:#f92672">()</span>
                        <span style="color:#f92672">.</span><span style="color:#a6e22e">withString</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;:v_artist&#34;</span><span style="color:#f92672">,</span> music<span style="color:#f92672">.</span><span style="color:#a6e22e">getArtist</span><span style="color:#f92672">())</span>
                        <span style="color:#f92672">.</span><span style="color:#a6e22e">withString</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;:v_title&#34;</span><span style="color:#f92672">,</span> music<span style="color:#f92672">.</span><span style="color:#a6e22e">getAlbumTitle</span><span style="color:#f92672">()));</span>
   
        ItemCollection<span style="color:#f92672">&lt;</span>QueryOutcome<span style="color:#f92672">&gt;</span> items <span style="color:#f92672">=</span> lsiAlbum<span style="color:#f92672">.</span><span style="color:#a6e22e">query</span><span style="color:#f92672">(</span>spec<span style="color:#f92672">);</span>
        Iterator<span style="color:#f92672">&lt;</span>Item<span style="color:#f92672">&gt;</span> itemsIter <span style="color:#f92672">=</span> items<span style="color:#f92672">.</span><span style="color:#a6e22e">iterator</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>itemsIter<span style="color:#f92672">.</span><span style="color:#a6e22e">hasNext</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            Item item <span style="color:#f92672">=</span> itemsIter<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">();</span>
            ObjectMapper mapper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ObjectMapper<span style="color:#f92672">();</span>
            mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">setPropertyNamingStrategy</span><span style="color:#f92672">(</span>PropertyNamingStrategy<span style="color:#f92672">.</span><span style="color:#a6e22e">UPPER_CAMEL_CASE</span><span style="color:#f92672">);</span>
            musicList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">readValue</span><span style="color:#f92672">(</span>item<span style="color:#f92672">.</span><span style="color:#a6e22e">toJSON</span><span style="color:#f92672">(),</span> Music<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">));</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> musicList<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
   
    <span style="color:#66d9ef">public</span> List<span style="color:#f92672">&lt;</span>Music<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">queryItemByGSI</span><span style="color:#f92672">(</span>Music music<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> JsonProcessingException <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>Music<span style="color:#f92672">&gt;</span> musicList <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
        QuerySpec spec <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> QuerySpec<span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">withKeyConditionExpression</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Upc = :v_upc&#34;</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">withValueMap</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ValueMap<span style="color:#f92672">().</span><span style="color:#a6e22e">withString</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;:v_upc&#34;</span><span style="color:#f92672">,</span> music<span style="color:#f92672">.</span><span style="color:#a6e22e">getUpc</span><span style="color:#f92672">()));</span>
        ItemCollection<span style="color:#f92672">&lt;</span>QueryOutcome<span style="color:#f92672">&gt;</span> items <span style="color:#f92672">=</span> gsiAlbum<span style="color:#f92672">.</span><span style="color:#a6e22e">query</span><span style="color:#f92672">(</span>spec<span style="color:#f92672">);</span>
        Iterator<span style="color:#f92672">&lt;</span>Item<span style="color:#f92672">&gt;</span> itemsIter <span style="color:#f92672">=</span> items<span style="color:#f92672">.</span><span style="color:#a6e22e">iterator</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>itemsIter<span style="color:#f92672">.</span><span style="color:#a6e22e">hasNext</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            Item item <span style="color:#f92672">=</span> itemsIter<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">();</span>
            ObjectMapper mapper <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ObjectMapper<span style="color:#f92672">();</span>
            mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">setPropertyNamingStrategy</span><span style="color:#f92672">(</span>PropertyNamingStrategy<span style="color:#f92672">.</span><span style="color:#a6e22e">UPPER_CAMEL_CASE</span><span style="color:#f92672">);</span>
            musicList<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">readValue</span><span style="color:#f92672">(</span>item<span style="color:#f92672">.</span><span style="color:#a6e22e">toJSON</span><span style="color:#f92672">(),</span> Music<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">));</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> musicList<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>Controller for CRUD</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">   
<span style="color:#a6e22e">@Controller</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/music&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MusicController</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Logger log <span style="color:#f92672">=</span> LoggerFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getLogger</span><span style="color:#f92672">(</span>MusicController<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    <span style="color:#a6e22e">@Inject</span>
    MusicDao musicDao<span style="color:#f92672">;</span>
    <span style="color:#a6e22e">@Inject</span>
    ObjectMapper mapper<span style="color:#f92672">;</span>
       
    <span style="color:#a6e22e">@Get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;{?music*}&#34;</span><span style="color:#f92672">)</span> <span style="color:#75715e">// this is used to mapping request parameters
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Produces</span><span style="color:#f92672">(</span>MediaType<span style="color:#f92672">.</span><span style="color:#a6e22e">APPLICATION_JSON</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> HttpResponse <span style="color:#a6e22e">getEvent</span><span style="color:#f92672">(</span>Music music<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        Music item <span style="color:#f92672">=</span> musicDao<span style="color:#f92672">.</span><span style="color:#a6e22e">getItem</span><span style="color:#f92672">(</span>music<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>item <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">final</span> ItemError notFound <span style="color:#f92672">=</span> ItemError<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">status</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getCode</span><span style="color:#f92672">())</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span><span style="color:#f92672">())</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">message</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;item not found&#34;</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">return</span> HttpResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">notFound</span><span style="color:#f92672">(</span>notFound<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> HttpResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">ok</span><span style="color:#f92672">(</span>item<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
   
    <span style="color:#a6e22e">@Get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/query/lsi{?music*}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#a6e22e">@Produces</span><span style="color:#f92672">(</span>MediaType<span style="color:#f92672">.</span><span style="color:#a6e22e">APPLICATION_JSON</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> HttpResponse <span style="color:#a6e22e">getEventByLSI</span><span style="color:#f92672">(</span>Music music<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> JsonProcessingException <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>Music<span style="color:#f92672">&gt;</span> items <span style="color:#f92672">=</span> musicDao<span style="color:#f92672">.</span><span style="color:#a6e22e">queryItemByLSI</span><span style="color:#f92672">(</span>music<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>items<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">final</span> ItemError notFound <span style="color:#f92672">=</span> ItemError<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">status</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getCode</span><span style="color:#f92672">())</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span><span style="color:#f92672">())</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">message</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;item not found&#34;</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">return</span> HttpResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">notFound</span><span style="color:#f92672">(</span>notFound<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> HttpResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">ok</span><span style="color:#f92672">(</span>items<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
   
    <span style="color:#a6e22e">@Get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/query/gsi{?music*}&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#a6e22e">@Produces</span><span style="color:#f92672">(</span>MediaType<span style="color:#f92672">.</span><span style="color:#a6e22e">APPLICATION_JSON</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> HttpResponse <span style="color:#a6e22e">getEventByGSI</span><span style="color:#f92672">(</span>Music music<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> JsonProcessingException <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>Music<span style="color:#f92672">&gt;</span> items <span style="color:#f92672">=</span> musicDao<span style="color:#f92672">.</span><span style="color:#a6e22e">queryItemByGSI</span><span style="color:#f92672">(</span>music<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>items<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">final</span> ItemError notFound <span style="color:#f92672">=</span> ItemError<span style="color:#f92672">.</span><span style="color:#a6e22e">builder</span><span style="color:#f92672">()</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">status</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getCode</span><span style="color:#f92672">())</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span><span style="color:#f92672">())</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">message</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;item not found&#34;</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">return</span> HttpResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">notFound</span><span style="color:#f92672">(</span>notFound<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">return</span> HttpResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">ok</span><span style="color:#f92672">(</span>items<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
   
    <span style="color:#a6e22e">@Post</span>
    <span style="color:#a6e22e">@Produces</span><span style="color:#f92672">(</span>MediaType<span style="color:#f92672">.</span><span style="color:#a6e22e">APPLICATION_JSON</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> HttpResponse <span style="color:#a6e22e">saveEvent</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Body</span> String body<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> JsonProcessingException <span style="color:#f92672">{</span>
        musicDao<span style="color:#f92672">.</span><span style="color:#a6e22e">saveItem</span><span style="color:#f92672">(</span>mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">readValue</span><span style="color:#f92672">(</span>body<span style="color:#f92672">,</span> Music<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">));</span>
        <span style="color:#66d9ef">return</span> HttpResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">ok</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
   
    <span style="color:#a6e22e">@Delete</span>
    <span style="color:#a6e22e">@Produces</span><span style="color:#f92672">(</span>MediaType<span style="color:#f92672">.</span><span style="color:#a6e22e">APPLICATION_JSON</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> HttpResponse <span style="color:#a6e22e">deleteEvent</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Body</span> String body<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> JsonProcessingException <span style="color:#f92672">{</span>
        musicDao<span style="color:#f92672">.</span><span style="color:#a6e22e">deleteItem</span><span style="color:#f92672">(</span>mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">readValue</span><span style="color:#f92672">(</span>body<span style="color:#f92672">,</span> Music<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">));</span>
        <span style="color:#66d9ef">return</span> HttpResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">ok</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>终于到了测试了</p>
<p>建立几个helper method：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">saveItem</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Music music<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> JsonProcessingException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">final</span> String body <span style="color:#f92672">=</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">writeValueAsString</span><span style="color:#f92672">(</span>music<span style="color:#f92672">);</span>
        client<span style="color:#f92672">.</span><span style="color:#a6e22e">toBlocking</span><span style="color:#f92672">().</span><span style="color:#a6e22e">exchange</span><span style="color:#f92672">(</span>HttpRequest<span style="color:#f92672">.</span><span style="color:#a6e22e">POST</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">,</span> body<span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// getItem要用partitionKey
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> Music <span style="color:#a6e22e">getItem</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Music music<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">final</span> String uri <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UriTemplate<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/{?artist,songTitle}&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">expand</span><span style="color:#f92672">(</span>music<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> client<span style="color:#f92672">.</span><span style="color:#a6e22e">toBlocking</span><span style="color:#f92672">().</span><span style="color:#a6e22e">retrieve</span><span style="color:#f92672">(</span>HttpRequest<span style="color:#f92672">.</span><span style="color:#a6e22e">GET</span><span style="color:#f92672">(</span>uri<span style="color:#f92672">),</span> Music<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// LSI和GSI需要用scan或者query
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> String <span style="color:#a6e22e">queryItemsByLSI</span><span style="color:#f92672">(</span>Music music<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">final</span> String uri <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UriTemplate<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/query/lsi{?artist,albumTitle}&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">expand</span><span style="color:#f92672">(</span>music<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> client<span style="color:#f92672">.</span><span style="color:#a6e22e">toBlocking</span><span style="color:#f92672">().</span><span style="color:#a6e22e">retrieve</span><span style="color:#f92672">(</span>HttpRequest<span style="color:#f92672">.</span><span style="color:#a6e22e">GET</span><span style="color:#f92672">(</span>uri<span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">private</span> String <span style="color:#a6e22e">queryItemsByGSI</span><span style="color:#f92672">(</span>Music music<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">final</span> String uri <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> UriTemplate<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/query/gsi{?upc}&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">expand</span><span style="color:#f92672">(</span>music<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> client<span style="color:#f92672">.</span><span style="color:#a6e22e">toBlocking</span><span style="color:#f92672">().</span><span style="color:#a6e22e">retrieve</span><span style="color:#f92672">(</span>HttpRequest<span style="color:#f92672">.</span><span style="color:#a6e22e">GET</span><span style="color:#f92672">(</span>uri<span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">deleteItem</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Music music<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> JsonProcessingException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">final</span> String delBody <span style="color:#f92672">=</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">writeValueAsString</span><span style="color:#f92672">(</span>music<span style="color:#f92672">);</span>
        client<span style="color:#f92672">.</span><span style="color:#a6e22e">toBlocking</span><span style="color:#f92672">().</span><span style="color:#a6e22e">exchange</span><span style="color:#f92672">(</span>HttpRequest<span style="color:#f92672">.</span><span style="color:#a6e22e">DELETE</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">,</span>delBody<span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>
</code></pre></div><p>测试：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"> <span style="color:#a6e22e">@Test</span>
 <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testGetEventByPartitionKey</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> JsonProcessingException <span style="color:#f92672">{</span>
     Music music <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Music<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Beyond&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Love&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Love&#34;</span><span style="color:#f92672">,</span> 1993<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;09000&#34;</span><span style="color:#f92672">);</span>
     saveItem<span style="color:#f92672">(</span>music<span style="color:#f92672">);</span>
     <span style="color:#75715e">// HashKey &#34;Beyond&#34;, RangeKey &#34;Love&#34;
</span><span style="color:#75715e"></span>     Music requestMusic <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Music<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Beyond&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Love&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
     Music result <span style="color:#f92672">=</span> getItem<span style="color:#f92672">(</span>requestMusic<span style="color:#f92672">);</span>

     assertTrue<span style="color:#f92672">(</span>result<span style="color:#f92672">.</span><span style="color:#a6e22e">getArtist</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Beyond&#34;</span><span style="color:#f92672">));</span>
     assertTrue<span style="color:#f92672">(</span>result<span style="color:#f92672">.</span><span style="color:#a6e22e">getAlbumTitle</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Love&#34;</span><span style="color:#f92672">));</span>
     assertTrue<span style="color:#f92672">(</span>result<span style="color:#f92672">.</span><span style="color:#a6e22e">getYear</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> 1993<span style="color:#f92672">);</span>
 <span style="color:#f92672">}</span>

 <span style="color:#a6e22e">@Test</span>
 <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testGetEventByLSI</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> JsonProcessingException <span style="color:#f92672">{</span>
     Music music <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Music<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Maroon 5&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;One More Night&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Overexposed&#34;</span><span style="color:#f92672">,</span> 2012<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;20120123&#34;</span><span style="color:#f92672">);</span>
     saveItem<span style="color:#f92672">(</span>music<span style="color:#f92672">);</span>
     Music music1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Music<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Maroon 5&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Payphone&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Overexposed&#34;</span><span style="color:#f92672">,</span> 2012<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;20120124&#34;</span><span style="color:#f92672">);</span>
     saveItem<span style="color:#f92672">(</span>music1<span style="color:#f92672">);</span>
     <span style="color:#75715e">// HashKey: &#34;Maroon 5&#34;, LSI RangeKey: &#34;Overexposed&#34;
</span><span style="color:#75715e"></span>     Music requestMusic <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Music<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Maroon 5&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Overexposed&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
     String musics <span style="color:#f92672">=</span> queryItemsByLSI<span style="color:#f92672">(</span>requestMusic<span style="color:#f92672">);</span>
     List<span style="color:#f92672">&lt;</span>Music<span style="color:#f92672">&gt;</span> musicList<span style="color:#f92672">;</span>

     musicList <span style="color:#f92672">=</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">readValue</span><span style="color:#f92672">(</span>musics<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> TypeReference<span style="color:#f92672">&lt;&gt;()</span> <span style="color:#f92672">{});</span>
     Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">sort</span><span style="color:#f92672">(</span>musicList<span style="color:#f92672">,</span> Comparator<span style="color:#f92672">.</span><span style="color:#a6e22e">comparing</span><span style="color:#f92672">(</span>Music<span style="color:#f92672">::</span>getUpc<span style="color:#f92672">));</span>
     assertTrue<span style="color:#f92672">(</span>musicList<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> 2<span style="color:#f92672">);</span>
     assertTrue<span style="color:#f92672">(</span>musicList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">).</span><span style="color:#a6e22e">getUpc</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;20120123&#34;</span><span style="color:#f92672">));</span>
     assertTrue<span style="color:#f92672">(</span>musicList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>1<span style="color:#f92672">).</span><span style="color:#a6e22e">getUpc</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;20120124&#34;</span><span style="color:#f92672">));</span>
 <span style="color:#f92672">}</span>

 <span style="color:#a6e22e">@Test</span>
 <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testGetEventByGSI</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> JsonProcessingException <span style="color:#f92672">{</span>
     Music music <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Music<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MJ&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Dangerous&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Dangerous&#34;</span><span style="color:#f92672">,</span> 1991<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;MJ-19910123&#34;</span><span style="color:#f92672">);</span>
     saveItem<span style="color:#f92672">(</span>music<span style="color:#f92672">);</span>
     <span style="color:#75715e">// GSI HashKey: &#34;MJ-19910123&#34;
</span><span style="color:#75715e"></span>     Music requestMusic <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Music<span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;MJ-19910123&#34;</span><span style="color:#f92672">);</span>
     String musics <span style="color:#f92672">=</span> queryItemsByGSI<span style="color:#f92672">(</span>requestMusic<span style="color:#f92672">);</span>
     List<span style="color:#f92672">&lt;</span>Music<span style="color:#f92672">&gt;</span> musicList<span style="color:#f92672">;</span>

     musicList <span style="color:#f92672">=</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">readValue</span><span style="color:#f92672">(</span>musics<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> TypeReference<span style="color:#f92672">&lt;&gt;()</span> <span style="color:#f92672">{});</span>
     assertTrue<span style="color:#f92672">(</span>musicList<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> 1<span style="color:#f92672">);</span>
     assertTrue<span style="color:#f92672">(</span>musicList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">).</span><span style="color:#a6e22e">getUpc</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MJ-19910123&#34;</span><span style="color:#f92672">));</span>
     assertTrue<span style="color:#f92672">(</span>musicList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">).</span><span style="color:#a6e22e">getArtist</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MJ&#34;</span><span style="color:#f92672">));</span>
     assertTrue<span style="color:#f92672">(</span>musicList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">).</span><span style="color:#a6e22e">getSongTitle</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Dangerous&#34;</span><span style="color:#f92672">));</span>
     assertTrue<span style="color:#f92672">(</span>musicList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">).</span><span style="color:#a6e22e">getAlbumTitle</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Dangerous&#34;</span><span style="color:#f92672">));</span>
     assertTrue<span style="color:#f92672">(</span>musicList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>0<span style="color:#f92672">).</span><span style="color:#a6e22e">getYear</span><span style="color:#f92672">().</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>1991<span style="color:#f92672">));</span>
 <span style="color:#f92672">}</span>
    
 <span style="color:#a6e22e">@Test</span>
 <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testDeleteEvent</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> JsonProcessingException <span style="color:#f92672">{</span>
     Music music <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Music<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Robin&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Angel&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Angel&#34;</span><span style="color:#f92672">,</span> 2000<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;08000&#34;</span><span style="color:#f92672">);</span>
     saveItem<span style="color:#f92672">(</span>music<span style="color:#f92672">);</span>
     Music delRequest <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Music<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Robin&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Angel&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
     deleteItem<span style="color:#f92672">(</span>delRequest<span style="color:#f92672">);</span>

     Music request <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Music<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Robin&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Angel&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
     <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
         getItem<span style="color:#f92672">(</span>request<span style="color:#f92672">);</span>
     <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>HttpClientResponseException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         assertEquals<span style="color:#f92672">(</span>HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">NOT_FOUND</span><span style="color:#f92672">,</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">getResponse</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getStatus</span><span style="color:#f92672">());</span>
         Optional<span style="color:#f92672">&lt;</span>ItemError<span style="color:#f92672">&gt;</span> jsonError <span style="color:#f92672">=</span> e<span style="color:#f92672">.</span><span style="color:#a6e22e">getResponse</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">(</span>ItemError<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
         assertTrue<span style="color:#f92672">(</span>jsonError<span style="color:#f92672">.</span><span style="color:#a6e22e">isPresent</span><span style="color:#f92672">());</span>
         log<span style="color:#f92672">.</span><span style="color:#a6e22e">debug</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Custom Error: {}&#34;</span><span style="color:#f92672">,</span> jsonError<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">());</span>
         assertEquals<span style="color:#f92672">(</span>404<span style="color:#f92672">,</span> jsonError<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getStatus</span><span style="color:#f92672">());</span>
         assertEquals<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;NOT_FOUND&#34;</span><span style="color:#f92672">,</span> jsonError<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getError</span><span style="color:#f92672">());</span>
         assertEquals<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;item not found&#34;</span><span style="color:#f92672">,</span> jsonError<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">());</span>
     <span style="color:#f92672">}</span>

 <span style="color:#f92672">}</span>
</code></pre></div></li>
</ol>
<h3 id="参考">参考</h3>
<ul>
<li><a href="https://github.com/aaronshaf/dynamodb-admin">https://github.com/aaronshaf/dynamodb-admin</a></li>
<li><a href="https://github.com/instructure/dynamo-local-admin-docker">https://github.com/instructure/dynamo-local-admin-docker</a></li>
</ul>

        </div>

        
        
          <div class="btn-improve-page">
              <a href="https://github.com/shubozhang/shubozhang.github.io/edit/source/content/posts/aws/dynamodb-admin.md">
                <i class="fas fa-code-branch"></i>
                Improve this page
              </a>
          </div>
        

        
      <hr />
        <div class="row next-prev-navigator">


  

  

  

  

  

  

  

  
    
      
      <div class="col-md-6 previous-article">
        <a href="/posts/tools/pg12/" class="btn btn-outline-info">
          <span><i class="fas fa-chevron-circle-left"></i> Prev</span>
          <br />
          <span>本地Docker安装Postgres 12 &#43; pgadmin （支持Apple M1)</span>
        </a>
      </div>
      
    
    
      
        
        
          
              
          
        
        <div class="col-md-6 next-article">
          <a href="/posts/tools/mac-world-time/" class="btn btn-outline-info">
            <span>Next <i class="fas fa-chevron-circle-right"></i></span>
            <br />
            <span>MacOS - Menu World Time</span>
          </a>
        </div>
      
    
  

  

  

  

  

  

</div>

      <hr />
      
      
          <div id="disqus_thread"></div>
<script type="text/javascript">
  (function () {
    
    
    if (window.location.hostname == "localhost") return;

    var dsq = document.createElement("script");
    dsq.type = "text/javascript";
    dsq.async = true;
    var disqus_shortname = "shubozhang";
    dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
    (
      document.getElementsByTagName("head")[0] ||
      document.getElementsByTagName("body")[0]
    ).appendChild(dsq);
  })();
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>
<a href="https://disqus.com/" class="dsq-brlink"
  >comments powered by <span class="logo-disqus">Disqus</span></a
>

      
      </div>
    </div>
  </div>
  
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#快速设置">快速设置</a></li>
        <li><a href="#ui测试">UI测试</a></li>
        <li><a href="#crud测试">CRUD测试</a></li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    

  




  




  
  
    
  









  







<footer class="container-fluid text-center align-content-center footer pb-2">
  <div class="container pt-5">
    <div class="row text-left">
      <div class="col-md-4 col-sm-12">
        <h5>Navigation</h5>
        
        <ul>
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#about">About Me</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#skills">Skills</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#experiences">Experiences</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#projects">Projects</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#recent-posts">Recent Posts</a>
              </li>
            
            
              
              
                
              
              <li class="nav-item">
                <a class="smooth-scroll" href="#achievements">Achievements</a>
              </li>
            
        </ul>
        

      </div>
      
      <div class="col-md-4 col-sm-12">
        <h5>Contact me:</h5>
        <ul>
          
          <li><span>Email: </span> <span>shubozhang@outlook.com</span></li>
          
          <li><span>Phone: </span> <span>&#43;0123456789</span></li>
          
        </ul>
      </div>
      
      
      <div class="col-md-4 col-sm-12">
        
        <p>Stay up to date with email notification</p>
        <form>
          <div class="form-group">
            <input
              type="email"
              class="form-control"
              id="exampleInputEmail1"
              aria-describedby="emailHelp"
              placeholder="Enter email"
            />
            <small id="emailHelp" class="form-text text-muted"
              >We&#39;ll never share your email with anyone else.</small
            >
          </div>
          <button type="submit" class="btn btn-info">Submit</button>
        </form>
      </div>
      
    </div>
  </div>
  <hr />
  <div class="container">
    <div class="row text-left">
      <div class="col-md-4">
        <a id="theme" href="https://github.com/hossainemruz/toha" target="#">
          <img src="/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png">
          Toha
        </a>
      </div>
      <div class="col-md-4 text-center">© 2020 Copyright.</div>
      <div class="col-md-4 text-right">
        <a id="hugo" href="https://gohugo.io/">Powered by
        <img
          src="/images/hugo-logo.svg"
          alt="Hugo Logo"
          height="18"
        />
        </a>
      </div>
    </div>
  </div>
</footer>

    <script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script src="/js/navbar.js"></script>
<script src="/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


  </body>
</html>
